%h4= @report.name
= form_tag run_canned_report_path(@report.id) do
  = render partial: 'shared/canned_report_form', locals: { report: @report, params: @params }
  .field
    = label_tag 'email', 'Email'
    = email_field_tag 'email', @params['email']
  .field
    = label 'schedule', 'Schedule'
    = select_recurring_tag 'schedule', @params['schedule']
  .field
    = label 'name', 'Report Name'
    = text_field_tag 'name', @params['name']
  .actions
    = submit_tag 'Run',
                class: "btn btn-primary"
    = submit_tag 'Email',
                class: "btn btn-secondary",
                formaction: email_canned_report_path
    = submit_tag 'Create Sheduled Report',
                class: "btn btn-secondary",
                formaction: create_scheduled_report_path,
                onclick: "return validateScheduleForm();"

- if @results.blank?
  %br
- elsif @results.count == 0
  %h3 No Results
  %br
- elsif @results.count > 0
  = render 'results'
  = button_to 'Export', export_canned_report_path(:id => @report.id), params: @params, method: :get, class: 'btn pull-right btn-primary'
%button{ "data-toggle" => "collapse", :href => "#sql" } Show SQL
.collapse#sql
  %p
  = @sql
%br
%button{ "data-toggle" => "collapse", :href => "#errors" } Show Errors
.collapse#errors
  %p
  = @errors
%br

:javascript
  function validateScheduleForm() {
    var email = document.getElementById('email').value;
    var schedule = document.getElementById('schedule').value;
    var name = document.getElementById('name').value;
    if (email == '' || schedule == '' || schedule == 'null' || name == '') {
      alert('Please fill out email, schedule, and report name fields.');
      return false;
    }
    return true;
  }
